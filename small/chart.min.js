"use strict";!function(){function i(){}function t(t){this.converter=t.converter,this.data=t.path||t.data,this.imageData=[],this.multiplier=t.multiplier||1,this.padding=t.padding||0,this.fps=t.fps||25,this.stepsPerFrame=~~t.stepsPerFrame||1,this.trailLength=t.trailLength||1,this.pointDistance=t.pointDistance||.05,this.domClass=t.domClass||"sonic",this.backgroundColor=t.backgroundColor||"rgba(0,0,0,0)",this.fillColor=t.fillColor,this.strokeColor=t.strokeColor,this.stepMethod="string"==typeof t.step?s[t.step]:t.step||s.square,this._setup=t.setup||i,this._teardown=t.teardown||i,this._preStep=t.preStep||i,this.pixelRatio=t.pixelRatio||null,this.width=t.width,this.height=t.height,this.fullWidth=this.width+2*this.padding,this.fullHeight=this.height+2*this.padding,this.domClass=t.domClass||"sonic",this.style=t.style||{},this.setup()}var f=t.argTypes={DIM:1,DEGREE:2,RADIUS:3,OTHER:0},d=t.argSignatures={arc:[1,1,3,2,2,0],bezier:[1,1,1,1,1,1,1,1],line:[1,1,1,1]},g=t.pathMethods={bezier:function(t,i,s,e,h,a,l,r,o){var n=1-(t=1-t),p=t*t,c=n*n,u=p*t,p=3*p*n,t=3*t*c,c=c*n;return[u*i+p*a+t*r+c*e,u*s+p*l+t*o+c*h]},arc:function(t,i,s,e,h,a){a=(a-h)*t+h,h=[Math.cos(a)*e+i,Math.sin(a)*e+s];return h.angle=a,h.t=t,h},line:function(t,i,s,e,h){return[(e-i)*t+i,(h-s)*t+s]}},s=t.stepMethods={square:function(t,i,s,e,h){this._.fillRect(t.x-3,t.y-3,6,6)},fader:function(t,i,s,e,h){this._.beginPath(),this._last&&this._.moveTo(this._last.x,this._last.y),this._.lineTo(t.x,t.y),this._.closePath(),this._.stroke(),this._last=t}};t.prototype={calculatePixelRatio:function(){return(window.devicePixelRatio||1)/(this._.webkitBackingStorePixelRatio||this._.mozBackingStorePixelRatio||this._.msBackingStorePixelRatio||this._.oBackingStorePixelRatio||this._.backingStorePixelRatio||1)},setup:function(){var t,i,s,e,h,a=this.data;for(h in this.canvas=document.createElement("canvas"),this.style)this.canvas.style[h]=this.style[h];this._=this.canvas.getContext("2d"),null==this.pixelRatio&&(this.pixelRatio=this.calculatePixelRatio()),this.canvas.className=this.domClass,1!==this.pixelRatio?(this.canvas.style.height=this.fullHeight+"px",this.canvas.style.width=this.fullWidth+"px",this.fullHeight*=this.pixelRatio,this.fullWidth*=this.pixelRatio,this.canvas.height=this.fullHeight,this.canvas.width=this.fullWidth,this._.scale(this.pixelRatio,this.pixelRatio)):(this.canvas.height=this.fullHeight,this.canvas.width=this.fullWidth),this.points=[];for(var l=-1,r=a.length;++l<r;){if(t=a[l].slice(1),(s=a[l][0])in d)for(var o=-1,n=t.length;++o<n;){switch(i=d[s][o],e=t[o],i){case f.RADIUS:e*=this.multiplier;break;case f.DIM:e=(e*=this.multiplier)+this.padding;break;case f.DEGREE:e*=Math.PI/180}t[o]=e}t.unshift(0);for(var p,c=this.pointDistance,u=c;u<=1;u+=c)u=Math.round(+u/c)/(1/c),t[0]=u,p=g[s].apply(null,t),this.points.push({x:p[0],y:p[1],progress:u})}this.frame=0,this.converter&&this.converter.setup&&this.converter.setup(this)},prep:function(t){if(!(t in this.imageData)){this._.clearRect(0,0,this.fullWidth,this.fullHeight),this._.fillStyle=this.backgroundColor,this._.fillRect(0,0,this.fullWidth,this.fullHeight);var i=this.points,s=i.length;this.pointDistance;this._setup();for(var e,h,a,l=-1,r=s*this.trailLength;++l<r&&!this.stopped;)(a=i[a=t+l]||i[a-s])&&(this.alpha=Math.round(l/(r-1)*1e3)/1e3,this._.globalAlpha=this.alpha,this.fillColor&&(this._.fillStyle=this.fillColor),this.strokeColor&&(this._.strokeStyle=this.strokeColor),e=t/(this.points.length-1),this._preStep(a,h=l/(r-1),e),this.stepMethod(a,h,e));return this._teardown(),!0}},draw:function(){this.prep(this.frame)||(this._.clearRect(0,0,this.fullWidth,this.fullWidth),this._.putImageData(this.imageData[this.frame],0,0)),this.converter&&this.converter.step&&this.converter.step(this),this.iterateFrame()||this.converter&&this.converter.teardown&&(this.converter.teardown(this),this.converter=null)},iterateFrame:function(){return this.frame+=this.stepsPerFrame,!(this.frame>=this.points.length&&(this.frame=0,1))},play:function(){this.stopped=!1;var t=this;this.timer=setInterval(function(){t.draw()},1e3/this.fps)},stop:function(){this.stopped=!0,this.timer&&clearInterval(this.timer)}},window.Sonic=t}();
"use strict";
"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var sc=window.sc||{},Render=function(){function e(){_classCallCheck(this,e),this.data=null}return _createClass(e,[{key:"setData",value:function(e){this.data=e}},{key:"drawLine",value:function(e,t,n,r,u){e.beginPath(),e.moveTo(t,r),e.lineTo(n,u),e.stroke(),e.closePath()}},{key:"floor",value:function(e,t){var n=Math.pow(10,t);return(Math.floor(e*n)/n).toFixed(t)}},{key:"formateValue",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2;return 0===e?0:1e6<e?100<(t=e/1e6)?this.floor(t,n-2)+"M":this.floor(t,n-1)+"M":1e3<e?100<(t=e/1e3)?this.floor(t,n-1)+"K":this.floor(t,n-2)+"K":100<e?this.floor(e,n-1):this.floor(e,n)}},{key:"formate",value:function(e,t){function n(e,t){return(e+="").length<t?new Array(++t-e.length).join("0")+e:e}var r=t?new Date(1e3*t):new Date,u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o={1:"st",2:"nd",3:"rd",21:"st",22:"nd",23:"rd",31:"st"},a=["","January","February","March","April","May","June","July","August","September","October","November","December"],i={d:function(){return n(i.j(),2)},D:function(){return i.l().substr(0,3)},j:function(){return r.getDate()},l:function(){return u[i.w()]},N:function(){return i.w()+1},S:function(){return o[i.j()]?o[i.j()]:"th"},w:function(){return r.getDay()},z:function(){return(r-new Date(r.getFullYear()+"/1/1"))/864e5>>0},W:function(){var e=i.z(),t=364+i.L()-e,n=(new Date(r.getFullYear()+"/1/1").getDay()||7)-1;return t<=2&&(r.getDay()||7)-1<=2-t?1:e<=2&&4<=n&&6-n<=e?(t=new Date(r.getFullYear()-1+"/12/31"),date("W",Math.round(t.getTime()/1e3))):1+(n<=3?(e+n)/7:(e-(7-n))/7)>>0},F:function(){return a[i.n()]},m:function(){return n(i.n(),2)},M:function(){return i.F().substr(0,3)},n:function(){return r.getMonth()+1},t:function(){var e;return 2==(e=r.getMonth()+1)?28+i.L():1&e&&e<8||!(1&e)&&7<e?31:30},L:function(){var e=i.Y();return 3&e||!(e%100)&&e%400?0:1},Y:function(){return r.getFullYear()},y:function(){return(r.getFullYear()+"").slice(2)},a:function(){return 11<r.getHours()?"pm":"am"},A:function(){return i.a().toUpperCase()},B:function(){var e=60*(r.getTimezoneOffset()+60),e=3600*r.getHours()+60*r.getMinutes()+r.getSeconds()+e,e=Math.floor(e/86.4);return 1e3<e&&(e-=1e3),e<0&&(e+=1e3),1===String(e).length&&(e="00"+e),e=2===String(e).length?"0"+e:e},g:function(){return r.getHours()%12||12},G:function(){return r.getHours()},h:function(){return n(i.g(),2)},H:function(){return n(r.getHours(),2)},i:function(){return n(r.getMinutes(),2)},s:function(){return n(r.getSeconds(),2)},O:function(){var e=n(Math.abs(r.getTimezoneOffset()/60*100),4);return e=0<r.getTimezoneOffset()?"-"+e:"+"+e},P:function(){var e=i.O();return e.substr(0,3)+":"+e.substr(3,2)},c:function(){return i.Y()+"-"+i.m()+"-"+i.d()+"T"+i.h()+":"+i.i()+":"+i.s()+i.P()},U:function(){return Math.round(r.getTime()/1e3)}};return e.replace(/([a-zA-Z])/g,function(e,t){return e==t&&i[t]?i[t]():t})}},{key:"fetch",value:function(e,t){var n=new XMLHttpRequest;n.onload=function(){var e;200===n.status&&0===(e=JSON.parse(n.responseText)).code&&e.data?t&&t(e.data):t&&t(!1)},n.addEventListener("error",function(e){t&&t(!1)},!1),n.open("GET",e,!0),n.withCredentials=!0,n.send(null)}},{key:"createDom",value:function(){var e=document.createElement("canvas");return e.width=this.width,e.height=this.height,e.style.width=.5*e.width+"px",e.style.height=.5*e.height+"px",e.style.position="absolute",e.style.left=0,e.style.top=0,e}},{key:"query",value:function(t){return"?"+Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}}]),e}();
"use strict";var _createClass=function(){function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var ChartGraph=function(){function d(t){_classCallCheck(this,d);var e=_possibleConstructorReturn(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));if(!t.el||!t.url&&!t.getData)return _possibleConstructorReturn(e);e.getData=t.getData,e.chartType=d.ChartType.candle,e.maxBarNum=60,e.minBarNum=25;e.options=Object.assign({el:"",url:"",updateInterval:3e3,request:{time:0,channel:"",period:1440,limit:"1500"},cache:!0,background:[{y0:0,y1:560,backgroundColor:"#101a27"},{y0:560,backgroundColor:"#131e2d"}],barNum:45,candle:{top:80,height:480,highColor:"#d04b64",lowColor:"#03ad8f",MA:[{ma:5,color:"#ffb1a0"},{ma:10,color:"#ff7bde"},{ma:30,color:"#6185ff"}]},bar:{top:620,height:50,highColor:"#d04b64",lowColor:"#03ad8f",yAxis:{fontSize:"20px",offset:500},MA:[{ma:5,color:"#ffb1a0"},{ma:30,color:"#6185ff"}]},xAxis:{offset:25,width:1,color:"#fff",position:"bottom",show:!1,mark:{lineWidth:1,lineColor:"#fff",textColor:"#fff",fontSize:"20px",lineHeight:5,show:!0}},yAxis:{offset:0,width:1,color:"#fff",position:"right",show:!1,mark:{lineWidth:1,lineColor:"#fff",textColor:"#fff",fontSize:"20px",lineHeight:5,show:!0}}},t),e.url=e.options.url,e.request=e.options.request,e.el=e.options.el,e.el.style.position="relative",e.updateTimerHandler=null,e.width=e.el.style.width||e.el.clientWidth,e.height=e.el.style.height?e.el.style.width:e.el.clientHeight,e.width*=2,e.height*=2,e.calculateBarNum(e.options.barNum),e.canvas=e.createDom(),e.ctx=e.canvas.getContext("2d"),e.ctx.translate(.5,.5),e.el.appendChild(e.canvas),e.aniCanvas=e.createDom(),e.aniCtx=e.aniCanvas.getContext("2d"),e.aniCtx.translate(.5,.5),e.el.appendChild(e.aniCanvas),e.topCanvas=e.createDom(),e.topCtx=e.topCanvas.getContext("2d"),e.topCtx.translate(.5,.5),e.el.appendChild(e.topCanvas),e.axis=new RenderAxis,e.candle=new RenderCandle,e.candleMA=new RenderCandleMA,e.bar=new RenderBar,e.barMA=new RenderBarMA,e.last=new RenderLast,e.time=new RenderTime,e.showCandleMA=!0,e.showBarMA=!0,e.priceFixed=5,e.ctx.fillStyle="#101a27",e.ctx.fillRect(0,0,e.width,e.height),e.lastBarItem=null,e.fetchData(),e.initEvent(),e.curSelectIndex=null,e.moveDis=0,e.minMoveDis=3,e.moveSpeed=3,e.stepDis=0;var t=e.options.locale||"zh-cn",i={"zh-cn":{date:"时间",open:"开",close:"收",high:"高",low:"低",change:"涨跌额",changer:"涨跌幅",executed:"成交量"},en:{date:"Date",open:"Open",close:"Close",high:"H",low:"L",change:"Change",changer:"Change%",executed:"Executed"}};return e.locale=i[t]||i.en,e}return _inherits(d,Render),_createClass(d,[{key:"calculateBarNum",value:function(t){return(t=t<this.minBarNum?this.minBarNum:t)>this.maxBarNum&&(t=this.maxBarNum),this.barNum!==t&&(this.barNum=t,this.barSpacing=(this.width-2*this.options.yAxis.offset)/this.barNum,this.leftBlank=parseInt((.2*this.width/this.barSpacing).toString()),!0)}},{key:"select",value:function(t){t=parseInt(t/this.barSpacing*2);this.curSelectIndex===this.visibleRange.from+t||(this.curSelectIndex=this.visibleRange.from+t,this.curSelectIndex>=this.data.bars.length)||(this.options.isTipWin||this.options.onSelect&&this.options.onSelect(this.data.bars[this.curSelectIndex]),this.drawTipWindow(this.curSelectIndex,t))}},{key:"selectIndex",value:function(t){this.data&&(this.curSelectIndex=t,t=-this.visibleRange.from+this.curSelectIndex,this.curSelectIndex>=this.data.bars.length||(this.options.isTipWin||this.options.onSelect&&this.options.onSelect(this.data.bars[this.curSelectIndex]),this.drawTipWindow(this.curSelectIndex,t)))}},{key:"drawTipWindow",value:function(t,e){this.curSelectIndex=t,this.topCtx.clearRect(0,0,this.width,this.height);var i,s,a,h,o,n,l,r,p,t=this.data.bars[this.curSelectIndex];t&&(i=(e+.5)*this.barSpacing,(l=this.topCtx.createLinearGradient(0,0,0,this.height)).addColorStop(0,"transparent"),l.addColorStop(.4,"rgba(204,204,204,0.4)"),l.addColorStop(.7,"rgba(204,204,204,0.4)"),l.addColorStop(1,"transparent"),this.topCtx.fillStyle=l,this.topCtx.fillRect(i-.5*this.barSpacing,0,this.barSpacing,this.height),l=this.options.candle.height/(this.yRange.max-this.yRange.min),s=void 0,this.chartType,d.ChartType.time,s=this.options.candle.height+this.options.candle.top-(t.close-this.yRange.min)*l,l=280,p=0,p=i<.5*this.width?(this.topCtx.lineWidth=1,this.topCtx.strokeStyle="#fff",this.drawLine(this.topCtx,112,this.width,s,s),this.topCtx.strokeStyle="#fff",this.topCtx.lineWidth=2,this.topCtx.beginPath(),this.topCtx.moveTo(2,s+20),this.topCtx.lineTo(92,s+20),this.topCtx.lineTo(112,s),this.topCtx.lineTo(92,s-20),this.topCtx.lineTo(2,s-20),this.topCtx.lineTo(2,s+20),this.topCtx.stroke(),this.topCtx.fillStyle="#181728",this.topCtx.fill(),this.topCtx.closePath(),this.topCtx.fillStyle="#fff",this.topCtx.font="20px Arial",this.topCtx.textAlign="center",this.topCtx.fillText(t.close,52,s+6,100),this.width-l):(this.topCtx.lineWidth=1,this.topCtx.strokeStyle="#fff",this.drawLine(this.topCtx,0,this.width-112,s,s),this.topCtx.beginPath(),this.topCtx.moveTo(this.width-112,s),this.topCtx.lineTo(this.width-92,s+20),this.topCtx.lineTo(this.width-2,s+20),this.topCtx.lineTo(this.width-2,s-20),this.topCtx.lineTo(this.width-92,s-20),this.topCtx.lineTo(this.width-112,s),this.topCtx.stroke(),this.topCtx.fillStyle="#161f2e",this.topCtx.fill(),this.topCtx.closePath(),this.topCtx.fillStyle="#fff",this.topCtx.font="20px Arial",this.topCtx.textAlign="center",this.topCtx.fillText(t.close,this.width-55,s+8,100),2),a=this.formate(this.xFormat,t.time),this.chartType===d.ChartType.candle&&this.options.isTipWin&&(h=this.options.candle.top-10,this.topCtx.strokeStyle="#fff",this.topCtx.lineWidth=2,this.topCtx.beginPath(),this.topCtx.moveTo(p,h),this.topCtx.lineTo(p+l-2,h),this.topCtx.lineTo(p+l-2,280+h),this.topCtx.lineTo(p,280+h),this.topCtx.lineTo(p,h),this.topCtx.stroke(),this.topCtx.fillStyle="#161f2e",this.topCtx.fill(),this.topCtx.closePath(),this.topCtx.fillStyle="#fff",this.topCtx.font="20px Arial",this.topCtx.textAlign="left",r=parseInt(84),o=parseInt(168),p=parseInt(p+10),this.topCtx.fillText(this.locale.date,p,parseInt(17+h+10),r),this.topCtx.fillText(this.locale.open,p,parseInt(51+h+10),r),this.topCtx.fillText(this.locale.high,p,parseInt(85+h+10),r),this.topCtx.fillText(this.locale.low,p,parseInt(119+h+10),r),this.topCtx.fillText(this.locale.close,p,parseInt(153+h+10),r),this.topCtx.fillText(this.locale.change,p,parseInt(187+h+10),r),this.topCtx.fillText(this.locale.changer,p,parseInt(221+h+10),r),this.topCtx.fillText(this.locale.executed,p,parseInt(255+h+10),r),r=this.formateValue(t.volume,this.priceFixed),p=p+l-22,this.topCtx.textAlign="right",this.topCtx.fillText(a,p,parseInt(17+h+10),o),this.topCtx.fillText(t.open,p,parseInt(51+h+10),o),this.topCtx.fillText(t.high,p,parseInt(85+h+10),o),this.topCtx.fillText(t.low,p,parseInt(119+h+10),o),this.topCtx.fillText(t.close,p,parseInt(153+h+10),o),this.topCtx.fillText(r,p,parseInt(255+h+10),o),r=l="n/a",(n=this.data.bars[this.curSelectIndex-1]?this.data.bars[this.curSelectIndex-1]:"")&&(r=((l=(t.close-n.close).toFixed(this.priceFixed))/n.close*100).toFixed(2),0<l?(this.topCtx.fillStyle="#03ad8f",l="+"+l,r="+"+r):this.topCtx.fillStyle="#d04b64"),this.topCtx.fillText(l,p,187+h+10,o),this.topCtx.fillText(r+"%",p,221+h+10,o)),this.topCtx.beginPath(),this.topCtx.arc(i,s,5,0,2*Math.PI),this.topCtx.fillStyle="#fff",this.topCtx.fill(),this.topCtx.closePath(),this.topCtx.strokeStyle="#fff",this.topCtx.lineWidth=2,n=this.height-2*this.options.xAxis.offset+4,l=this.topCtx.measureText(a).width+20,this.topCtx.beginPath(),this.topCtx.moveTo(i-.5*l,n),this.topCtx.lineTo(i+.5*l,n),this.topCtx.lineTo(i+.5*l,40+n),this.topCtx.lineTo(i-.5*l,40+n),this.topCtx.lineTo(i-.5*l,n),this.topCtx.stroke(),this.topCtx.fillStyle="#161f2e",this.topCtx.fill(),this.topCtx.closePath(),this.topCtx.fillStyle="#fff",this.topCtx.font="20px Arial",this.topCtx.textAlign="center",this.topCtx.fillText(a,i,25+n,l),this.showCandleMA&&this.chartType===d.ChartType.candle&&(r=this.candleMA.getMaWidthIndex(this.visibleRange.from+e),this.drawCandleMAMark(r)),this.showBarMA)&&(p=this.barMA.getMaWidthIndex(this.visibleRange.from+e),this.drawBarMAMark(p,t.volume))}},{key:"drawCandleMAMark",value:function(t){if(this.chartType===d.ChartType.candle)if(t&&t.length){this.topCtx.font="20px Arial",this.topCtx.textAlign="left";for(var e=10,i=0;i<t.length;++i){this.topCtx.fillStyle=t[i].color;var s="MA"+t[i].ma+":"+this.floor(t[i].y,this.priceFixed),a=this.topCtx.measureText(s).width;this.topCtx.fillText(s,e,25,a),e+=a+15}}else if(!t)if(this.data.bars[this.data.bars.length-1])for(var h=this.candleMA.getMaWidthIndex(this.data.bars.length-1),o=(this.topCtx.font="20px Arial",this.topCtx.textAlign="left",10),n=0;n<h.length;++n){this.topCtx.fillStyle=h[n].color;var l="MA"+h[n].ma+":"+this.floor(h[n].y,this.priceFixed),r=this.topCtx.measureText(l).width;this.topCtx.fillText(l,o,25,r),o+=r+15}}},{key:"drawBarMAMark",value:function(t,e){if(t&&t.length){this.topCtx.font="20px Arial",this.topCtx.textAlign="left";for(var i=this.options.candle.top+this.options.candle.height,e="VOL:"+this.formateValue(e,this.priceFixed),s=this.topCtx.measureText(e).width,a=(this.topCtx.fillText(e,10,i+25,s),s+25),h=0;h<t.length;++h){this.topCtx.fillStyle=t[h].color;var o="MA"+t[h].ma+":"+this.formateValue(t[h].y,this.priceFixed),n=this.topCtx.measureText(o).width;this.topCtx.fillText(o,a,i+25,n),a+=n+15}}else if(!t){e=this.data.bars[this.data.bars.length-1];if(e)for(var l=this.barMA.getMaWidthIndex(this.data.bars.length-1),r=(this.topCtx.font="20px Arial",this.topCtx.textAlign="left",this.options.candle.top+this.options.candle.height),s="VOL:"+this.formateValue(e.volume,this.priceFixed),e=this.topCtx.measureText(s).width,p=(this.topCtx.fillText(s,10,r+25,e),e+25),d=0;d<l.length;++d){this.topCtx.fillStyle=l[d].color;var c="MA"+l[d].ma+":"+this.formateValue(l[d].y,this.priceFixed),g=this.topCtx.measureText(c).width;this.topCtx.fillText(c,p,r+25,g),p+=g+15}}}},{key:"stopMoveAnimation",value:function(){this.loopId&&(window.cancelAnimationFrame(this.loopId),this.loopId=null)}},{key:"startMoveAnimation",value:function(){this.moveDis*=12,Math.abs(this.moveDis)<this.minMoveDis||(this.moveSpeed=15,this.stepDis=0,this.loop())}},{key:"loop",value:function(){var t=this;this.loopId=window.requestAnimationFrame(function(){t.loopId=null,t.stepDis+=t.moveSpeed,t.moveDis<0?t.moveDis>-t.stepDis?t.updateVisible(1):(t.stepDis>t.barSpacing&&(t.stepDis-=t.barSpacing,t.moveDis+=t.barSpacing,t.updateVisible(1)),t.loop()):0<t.moveDis&&(t.moveDis<t.stepDis?t.updateVisible(-1):(t.stepDis>t.barSpacing&&(t.stepDis-=t.barSpacing,t.moveDis-=t.barSpacing,t.updateVisible(-1)),t.loop()))})}},{key:"updateVisible",value:function(t){var e,i;0<t?(i=this.visibleRange.to+t,(e=this.visibleRange.from+t)<=this.data.bars.length-this.barNum+this.leftBlank&&(i>this.data.bars.length&&(i=this.data.bars.length),this.visibleRange={from:e,to:i},this.draw())):t<0&&((i=(e=(e=this.visibleRange.from+t)<0?0:e)+this.barNum)>this.data.bars.length&&(i=this.data.bars.length),this.visibleRange={from:e,to:i},this.draw())}},{key:"initEvent",value:function(){function a(t){var e,i,s,a;l&&(e=t.touches?t.touches[0]:{pageX:t.pageX,pageY:t.pageY},s=Math.abs(c-e.pageY),Math.abs(d-e.pageX)<s?(p&&(clearTimeout(p),p=null),t.stopPropagation()):(t.preventDefault(),t.touches&&u&&1<t.touches.length&&((s={x0:t.touches[0].pageX,x1:t.touches[1].pageX}).dis=Math.abs(s.x0-s.x1),(t=Math.abs(u.dis-s.dis))>o.barSpacing)&&(t=parseInt(t/o.barSpacing),s.dis<u.dis?o.calculateBarNum(o.barNum+t)&&((a=(i=o.visibleRange.from)+o.barNum)>o.data.bars.length&&(a=o.data.bars.length)-i<=o.barNum-o.leftBlank&&(i=a-o.barNum-o.leftBlank),o.visibleRange={from:i,to:a},o.draw()):o.calculateBarNum(o.barNum-t)&&((a=(i=o.visibleRange.from)+o.barNum)>o.data.bars.length&&(a=o.data.bars.length),o.visibleRange={from:i,to:a},o.draw()),u=s),x&&(p&&(clearTimeout(p),p=null),g||(n.moveDis=0),g=!0,r?n.select(e.pageX):(t=e.pageX-d,(n.moveDis=t)<0?(t=-t,i=parseInt((t/n.barSpacing).toString()),0<(i+=1)&&(a=n.visibleRange.to+i,(s=n.visibleRange.from+i)<=n.data.bars.length-n.barNum+n.leftBlank)&&(a>n.data.bars.length&&(a=n.data.bars.length),n.visibleRange={from:s,to:a},n.draw(),d=e.pageX)):0<t&&(i=parseInt((t/n.barSpacing).toString()),0<(i+=1))&&((a=(s=(s=n.visibleRange.from-i)<0?0:s)+n.barNum)>n.data.bars.length&&(a=n.data.bars.length),n.visibleRange={from:s,to:a},n.draw(),d=e.pageX)))))}function h(t){if(window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",h),u)u=null;else{var e,i,s;if(!x)return x=!0,i=t.changedTouches?t.changedTouches[0]:{pageX:t.pageX,pageY:t.pageY},e=o.el.getBoundingClientRect().top,e=2*(i.pageY-e),s=o.last.getRect(),i&&s&&s.x0<2*i.pageX&&s.x1>2*i.pageX&&s.y0<e&&s.y1>e?(i=o.data.bars.length,s=(s=(s=o.data.bars.length-o.barNum+o.leftBlank)<0?0:s)>o.data.bars.length?o.data.bars.length-1:s,o.visibleRange={from:s,to:i},void o.draw()):void 0;p&&(clearTimeout(p),p=null),g?r||o.startMoveAnimation():!r&&o.curSelectIndex?(o.curSelectIndex=null,o.options.isTipWin||o.options.onSelect&&o.options.onSelect(),o.drawTip()):r||o.select((t.changedTouches?t.changedTouches[0]:t).pageX),g=r=l=!1}}var o=this,n=this,l=!1,r=!1,p=null,d=null,c=null,g=!1,x=!1,u=null;this.topCanvas.addEventListener("mousedown",function(t){if(o.stopMoveAnimation(),l||p||t.touches&&1!==t.touches.length)t.touches&&1<t.touches.length&&(p&&(clearTimeout(p),p=null),(u={x0:t.touches[0].pageX,x1:t.touches[1].pageX}).dis=Math.abs(u.x0-u.x1),x=!1);else{var t=t.touches?t.touches[0]:{pageX:t.pageX,pageY:t.pageY},e=(d=t.pageX,c=t.pageY,o.last.getRect()),i=o.el.getBoundingClientRect().top,i=2*(t.pageY-i);if(e&&e.x0<2*d&&e.x1>2*d&&e.y0<i&&e.y1>i)return void(x=!1);x=!0;t=parseInt(d/o.barSpacing*2);o.visibleRange.from+t===o.curSelectIndex?r=!0:(r=!1,p=setTimeout(function(){r=!(p=null),o.select(d)},300)),l=!0}window.addEventListener("mousemove",a),window.addEventListener("mouseup",h)})}},{key:"initChart",value:function(t){var e;this.lastBarItem=t[t.length-1],this.data={bars:t},this.xaisxFormat(),0!==this.data.bars.length&&(t=this.data.bars.length,e=(e=(e=this.data.bars.length-this.barNum+this.leftBlank)<0?0:e)>this.data.bars.length?this.data.bars.length-1:e,this.visibleRange={from:e,to:t},this.axis.setData({xAxis:this.options.xAxis,yAxis:this.options.yAxis,width:this.width,height:this.height,xFormat:this.xFormat,candle:this.options.candle,fixed:this.priceFixed}),this.candle.setData({width:this.width,height:this.height,config:this.options.candle}),this.candleMA.setData({bars:this.data.bars,width:this.width,height:this.height,MA:this.options.MA,candle:this.options.candle,fixed:this.priceFixed}),this.bar.setData({width:this.width,height:this.height,config:this.options.bar,candle:this.options.candle,fixed:this.priceFixed}),this.barMA.setData({width:this.width,height:this.height,config:this.options.bar,bars:this.data.bars}),this.last.setData({width:this.width,height:this.height,config:this.options.candle,fixed:this.priceFixed}),this.time.setData({width:this.width,height:this.height,config:this.options.candle,fixed:this.priceFixed}),this.draw())}},{key:"drawTip",value:function(){this.topCtx.clearRect(0,0,this.width,this.height),this.drawCandleMAMark(),this.drawBarMAMark(),this.curSelectIndex&&this.selectIndex(this.curSelectIndex)}},{key:"draw",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBackground();var t=1e9,e=0,i=[],s=-100;if(this.chartType===d.ChartType.candle){for(var a=this.visibleRange.from;a<this.visibleRange.to;++a){var h=this.data.bars[a];(t=t>parseFloat(h.high)?parseFloat(h.high):t)>parseFloat(h.low)&&(t=parseFloat(h.low)),(e=e<parseFloat(h.high)?parseFloat(h.high):e)<parseFloat(h.low)&&(e=parseFloat(h.low)),s<parseFloat(h.volume)&&(s=parseFloat(h.volume)),i.push(h.time)}this.showCandleMA?this.yRange=this.candleMA.getYRange(this.visibleRange,t,e):this.yRange={min:t,max:e}}else if(this.chartType===d.ChartType.time){for(var o=this.visibleRange.from;o<this.visibleRange.to;++o){var n=this.data.bars[o];t>parseFloat(n.close)&&(t=parseFloat(n.close)),e<parseFloat(n.close)&&(e=parseFloat(n.close)),s<parseFloat(n.volume)&&(s=parseFloat(n.volume)),i.push(n.time)}this.showCandleMA?this.yRange=this.candleMA.getYRange(this.visibleRange,0,e):this.yRange={min:0,max:e}}this.showBarMA&&(s=this.barMA.getYRange(this.visibleRange,s)),this.chartType===d.ChartType.candle?(this.candle.draw(this.ctx,this.data.bars,this.visibleRange,this.yRange,this.barSpacing),this.showCandleMA&&this.candleMA.draw(this.ctx,this.visibleRange,this.yRange,this.barSpacing)):this.time.draw(this.ctx,this.data.bars,this.visibleRange,this.yRange,this.barSpacing),this.bar.draw(this.ctx,this.data.bars,this.visibleRange,s,this.barSpacing),this.showBarMA&&this.barMA.draw(this.ctx,this.visibleRange,s,this.barSpacing),this.axis.draw(this.ctx,i,this.yRange,this.barNum),this.aniCtx.clearRect(0,0,this.width,this.height),this.last.draw(this.aniCtx,this.lastBarItem,this.visibleRange.to-this.visibleRange.from-1,this.yRange,this.barSpacing,this.chartType===d.ChartType.time),this.drawTip()}},{key:"fetchData",value:function(){var e=this;this.loading(),this.getData?this.getData(this.request).then(function(t){e.removeLoading(),t?e.loadData(t):console.log("network error",t)}):this.fetch(this.url+this.query(this.request),function(t){e.removeLoading(),t?e.loadData(t):console.log("network error",t)})}},{key:"loadData",value:function(t){var e=this;if(0!==t.length){for(var i=[],s=0;s<t.length;++s){var a=t[s],a={time:a[0],open:a[1],high:a[2],low:a[3],close:a[4],volume:a[5]};i.push(a)}this.initChart(i),clearTimeout(this.updateTimerHandler),this.updateTimerHandler=setTimeout(function(){e.startUpdate()},this.options.updateInterval)}}},{key:"xaisxFormat",value:function(){1==this.request.period?this.xFormat="H:i":this.request.period<1440?this.xFormat="m-d H:i":this.xFormat="y-m-d"}},{key:"drawBackground",value:function(){for(var e=this,t=(this.options.background&&this.options.background.forEach(function(t){e.ctx.fillStyle=t.backgroundColor,t.y1?e.ctx.fillRect(0,t.y0,e.canvas.width,t.y1):e.ctx.fillRect(0,t.y0,e.canvas.width,e.height)}),this.ctx.lineWidth=1,this.ctx.strokeStyle="#1a283a",this.options.candle.height/4),i=(this.width-2*this.options.yAxis.offset)/5,s=this.height-2*this.options.xAxis.offset,a=1;a<5;a++){var h=parseInt((a*i).toString());this.drawLine(this.ctx,h,h,0,s)}for(var o=this.width-this.options.yAxis.offset,n=0;n<5;++n){var l=this.options.candle.top+(4-n)*t;4===n&&(l-=10),this.drawLine(this.ctx,0,o,l,l)}}},{key:"loading",value:function(){this.loadingCanvas||(this.loadingCanvas=new Sonic({width:.5*this.width,height:.5*this.height,stepsPerFrame:3,trailLength:1,pointDistance:.01,fps:30,step:"fader",style:{position:"absolute",left:0,top:0},strokeColor:"#456995",setup:function(){this._.lineWidth=5},path:[["arc",.25*this.width+20,.25*this.height,30,360,0]]}),this.loadingCanvas.play(),this.el.appendChild(this.loadingCanvas.canvas))}},{key:"removeLoading",value:function(){this.loadingCanvas&&(this.el.removeChild(this.loadingCanvas.canvas),delete this.loadingCanvas,this.loadingCanvas=null)}},{key:"startUpdate",value:function(){var e=this;this.stopUpdate(),this.options.updateInterval&&(this.updateTimerHandler=setTimeout(function(){e.getData?e.getData({time:e.lastBarItem.time,channel:e.request.channel,limit:10,period:e.request.period}).then(function(t){t&&0<t.length&&e.appendItems(t),e.startUpdate()}):e.fetch(e.url+e.query({time:e.lastBarItem.time,channel:e.request.channel,limit:10,period:e.request.period}),function(t){t&&0<t.length&&e.appendItems(t),e.startUpdate()})},this.options.updateInterval))}},{key:"stopUpdate",value:function(){this.updateTimerHandler&&(clearTimeout(this.updateTimerHandler),this.updateTimerHandler=null)}},{key:"appendItems",value:function(t){if(t.length){var e=t[0],e={time:e[0],open:e[1],high:e[2],low:e[3],close:e[4],volume:e[5]};this.data.bars[this.data.bars.length-1]=e;for(var i=1;i<t.length;++i){var s=t[i],s={time:s[0],open:s[1],high:s[2],low:s[3],close:s[4],volume:s[5]};this.data.bars.push(s)}e=this.data.bars[this.data.bars.length-1];(1<t.length||e.time!==this.lastBarItem.time||e.open!==this.lastBarItem.open||e.high!==this.lastBarItem.high||e.low!==this.lastBarItem.low||e.close!==this.lastBarItem.close||e.volume!==this.lastBarItem.volume)&&(this.lastBarItem=e,this.candleMA.updateData(),this.barMA.updateData(),this.visibleRange.to===this.data.bars.length-t.length+1&&(this.visibleRange.from+=t.length-1,this.visibleRange.to+=t.length-1),this.draw())}}},{key:"showTime",value:function(){this.chartType!==d.ChartType.time&&(this.chartType=d.ChartType.time,this.request.period=1,this.last.stop(),this.stopUpdate(),this.stopMoveAnimation(),this.fetchData())}},{key:"update",value:function(t){t.request&&((t=Object.assign({},this.request,t.request)).period||this.request.period!==t.period||this.request.channel!==t.channel)&&(this.chartType=d.ChartType.candle,this.request=t,this.last.stop(),this.stopUpdate(),this.stopMoveAnimation(),this.fetchData())}},{key:"updateChangeMa",value:function(t){this.showCandleMA!==t&&(this.showCandleMA=t,this.chartType===d.ChartType.candle)&&(this.last.stop(),this.stopUpdate(),this.stopMoveAnimation(),this.draw())}},{key:"destroy",value:function(){this.stopUpdate(),this.stopMoveAnimation(),this.last.stop()}}]),d}();ChartGraph.ChartType={time:"time",candle:"candle"};
"use strict";var _createClass=function(){function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}}(),_get=function t(e,i,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);return void 0!==o?"value"in o?o.value:void 0!==(o=o.get)?o.call(r):void 0:null!==(o=Object.getPrototypeOf(e))?t(o,i,r):void 0};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var RenderAxis=function(){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.size={w:0,h:0},t.fixed=8,t}return _inherits(e,Render),_createClass(e,[{key:"setData",value:function(t){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.size.w=this.data.width-2*this.data.yAxis.offset,this.size.h=this.data.height-2*this.data.xAxis.offset,this.fixed=t.fixed||8}},{key:"draw",value:function(t,e,i,r){for(var o=this.data.xAxis,n=this.data.yAxis,a=this.data.height-2*o.offset,s=o.mark,l=(t.fillStyle="#666e92",t.font=s.fontSize+" Arial",t.textAlign="center",(this.data.width-2*n.offset)/5),f=(parseInt((e.length/5).toString()),Math.floor(r/5)),h=0;h<6;h++){var c=h*f;if(c<e.length){var u=parseInt((h*l).toString()),c=e[c],p=a+s.lineHeight;t.fillText(this.formate(this.data.xFormat,c),u,p+24,120)}else if(h<5||h<6&&e.length===r){c=parseInt((h*l).toString()),u=e[e.length-1],p=a+s.lineHeight;t.fillText(this.formate(this.data.xFormat,u),c,p+24,120);break}}s=n.mark,t.font=s.fontSize+" Arial",t.textAlign="right";for(var d=this.data.candle.height/4,g=(i.max-i.min)/4,y=0;y<5;++y){var b=this.data.candle.top+(4-y)*d,_=(0===y?b-=12:4===y?b+=8:b-=8,(parseFloat(i.min)+parseFloat((g*y).toString())).toFixed(this.fixed));t.fillText(_,this.data.width-10,b,100)}}}]),e}();
"use strict";var _createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var RenderLine=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,Render),_createClass(e,[{key:"drawBezier",value:function(e,t){e.strokeStyle=t.color,e.lineWidth=2,e.beginPath();for(var r,n=!1,o=0;o<t.renderItems.length;o++)"-"===t.renderItems[o].y||n?(r=this.getCtrlPoint(t.renderItems,o-1),e.bezierCurveTo(r.pA.x,r.pA.y,r.pB.x,r.pB.y,t.renderItems[o].x,t.renderItems[o].y)):(n=!0,e.moveTo(t.renderItems[o].x,t.renderItems[o].y));e.stroke()}},{key:"getCtrlPoint",value:function(e,t,r,n){r&&n||(n=r=.25);var o=void 0,i=void 0,s=void 0,a=void 0,i=t<1?(o=e[0].x+(e[1].x-e[0].x)*r,e[0].y+(e[1].y-e[0].y)*r):(o=e[t].x+(e[t+1].x-e[t-1].x)*r,e[t].y+(e[t+1].y-e[t-1].y)*r);return a=t>e.length-3?(s=e[r=e.length-1].x-(e[r].x-e[r-1].x)*n,e[r].y-(e[r].y-e[r-1].y)*n):(s=e[t+1].x-(e[t+2].x-e[t].x)*n,e[t+1].y-(e[t+2].y-e[t].y)*n),{pA:{x:o,y:i},pB:{x:s,y:a}}}}]),e}();
"use strict";var _createClass=function(){function r(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,o){return e&&r(t.prototype,e),o&&r(t,o),t}}(),_get=function t(e,o,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,o);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(r):void 0:null!==(n=Object.getPrototypeOf(e))?t(n,o,r):void 0};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var RenderBar=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return _inherits(e,Render),_createClass(e,[{key:"setData",value:function(t){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.height=this.data.config.top+this.data.config.height,this.fixed=t.fixed||8}},{key:"draw",value:function(t,e,o,r,n){for(var i=this.data.config.height/r,a=parseInt(this.height-1),s=o.from;s<o.to;++s){var l=s-o.from,c=e[s],f=this.data.config.lowColor,f=(parseFloat(c.open)<=parseFloat(c.close)?(f=this.data.config.highColor,c.open,c.close):(c.close,c.open),t.strokeStyle=f,parseInt((.5+l)*n)),l=parseInt(this.height-c.volume*i);t.lineWidth=n-2,this.drawLine(t,f,f,a,l)}t.fillStyle="#666e92",t.font=this.data.config.yAxis.fontSize+" Arial",t.textAlign="right",t.fillText(this.formateValue(r,this.fixed),this.data.width-10,this.data.candle.top+this.data.candle.height+25,200)}}]),e}();
"use strict";var _createClass=function(){function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}}(),_get=function t(e,o,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,o);return void 0!==r?"value"in r?r.value:void 0!==(r=r.get)?r.call(n):void 0:null!==(r=Object.getPrototypeOf(e))?t(r,o,n):void 0};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var RenderCandle=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return _inherits(e,Render),_createClass(e,[{key:"setData",value:function(t){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.height=this.data.config.top+this.data.config.height}},{key:"draw",value:function(t,e,o,n,r){for(var i=n.max-n.min,a=this.data.config.height/i,s=o.from;s<o.to;++s){var l=s-o.from,c=e[s],h=this.data.config.lowColor,h=(parseFloat(c.open)<=parseFloat(c.close)?(h=this.data.config.highColor,c.open,c.close):(c.close,c.open),t.strokeStyle=h,parseInt(this.height-(c.high-n.min)*a)),p=parseInt(this.height-(c.low-n.min)*a),l=parseInt((.5+l)*r),h=(t.lineWidth=2,this.drawLine(t,l,l,h,p),parseInt(this.height-(c.open-n.min)*a)),p=parseInt(this.height-(c.close-n.min)*a);h-p<2&&(--h,p+=1),t.lineWidth=r-2,this.drawLine(t,l,l,h,p)}}}]),e}();
"use strict";var _createClass=function(){function r(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,a){return e&&r(t.prototype,e),a&&r(t,a),t}}(),_get=function t(e,a,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,a);return void 0!==o?"value"in o?o.value:void 0!==(o=o.get)?o.call(r):void 0:null!==(o=Object.getPrototypeOf(e))?t(o,a,r):void 0};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var RenderCandleMA=function(){function r(){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.fixed=8,t.height=0,t}return _inherits(r,RenderLine),_createClass(r,[{key:"setData",value:function(t){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setData",this).call(this,t),this.height=this.data.candle.top+this.data.candle.height,this.fixed=t.fixed||8,this.ma=[];for(var e=0;e<t.candle.MA.length;++e){var a=t.candle.MA[e];a.items=this.calculateMA(a.ma,t.bars),this.ma.push(a)}}},{key:"updateData",value:function(){for(var t=this.ma[0].items.length-1,e=0;e<this.ma.length;++e)for(var a=this.ma[e],r=t;r<this.data.bars.length;++r)if(r<a.ma)r!==t&&a.items.push("-");else{for(var o=0,i=0;i<a.ma;i++)o=parseFloat(o)+parseFloat(this.data.bars[r-i].close);r!==t?a.items[r]=parseFloat(parseFloat(o)/parseFloat(a.ma)).toFixed(this.fixed):a.items.push(parseFloat(parseFloat(o)/parseFloat(a.ma)).toFixed(this.fixed))}}},{key:"getYRange",value:function(t,e,a){for(var r=parseFloat(e),o=parseFloat(a),i=0;i<this.ma.length;++i)for(var s=t.from;s<t.to;++s){var n=this.ma[i].items[s];"-"!==n&&((n=parseFloat(n))<r?r=n:o<n&&(o=n))}return{min:parseFloat(r),max:parseFloat(o)}}},{key:"getMaWidthIndex",value:function(t){for(var e=[],a=0;a<this.ma.length;++a)this.ma[a].items[t]&&"-"!==this.ma[a].items[t]&&e.push({ma:this.ma[a].ma,color:this.ma[a].color,y:this.ma[a].items[t]});return e}},{key:"draw",value:function(t,e,a,r){for(var o=a.max-a.min,i=this.data.candle.height/o,s=0;s<this.ma.length;++s)this.ma[s].renderItems=[];for(var n=e.from;n<e.to;++n)for(var l=n-e.from,h=parseInt((.5+l)*r),u=0;u<this.ma.length;++u){var c=this.ma[u].items[n],c=parseInt(this.height-(c-a.min)*i);this.ma[u].renderItems.push({x:h,y:c})}for(var p=0;p<this.ma.length;++p)this.drawBezier(t,this.ma[p])}},{key:"calculateMA",value:function(t,e){for(var a=[],r=0,o=e.length;r<o;r++)if(r<t)a.push("-");else{for(var i=0,s=0;s<t;s++)i=parseFloat(i)+parseFloat(e[r-s].close);a.push(parseFloat(parseFloat(i)/parseFloat(t)).toFixed(this.fixed))}return a}}]),r}();
"use strict";var _createClass=function(){function r(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,a){return e&&r(t.prototype,e),a&&r(t,a),t}}(),_get=function t(e,a,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,a);return void 0!==o?"value"in o?o.value:void 0!==(o=o.get)?o.call(r):void 0:null!==(o=Object.getPrototypeOf(e))?t(o,a,r):void 0};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var RenderBarMA=function(){function r(){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.fixed=8,t.height=0,t}return _inherits(r,RenderLine),_createClass(r,[{key:"setData",value:function(t){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setData",this).call(this,t),this.height=this.data.config.top+this.data.config.height,this.fixed=t.fixed||8,this.ma=[];for(var e=0;e<t.config.MA.length;++e){var a=t.config.MA[e];a.items=this.calculateMA(a.ma,t.bars),this.ma.push(a)}}},{key:"updateData",value:function(){for(var t=this.ma[0].items.length-1,e=0;e<this.ma.length;++e)for(var a=this.ma[e],r=t;r<this.data.bars.length;++r)if(r<a.ma)r!==t&&a.items.push("-");else{for(var o=0,i=0;i<a.ma;i++)o=parseFloat(o)+parseFloat(this.data.bars[r-i].volume);r!==t?a.items[r]=parseFloat(parseFloat(o)/parseFloat(a.ma)).toFixed(this.fixed):a.items.push(parseFloat(parseFloat(o)/parseFloat(a.ma)).toFixed(this.fixed))}}},{key:"getYRange",value:function(t,e){for(var a=e,r=0;r<this.ma.length;++r)for(var o=t.from;o<t.to;++o){var i=this.ma[r].items[o];"-"!==i&&e<(i=parseFloat(i))&&(a=i)}return a}},{key:"getMaWidthIndex",value:function(t){for(var e=[],a=0;a<this.ma.length;++a)this.ma[a].items[t]&&"-"!==this.ma[a].items[t]&&e.push({ma:this.ma[a].ma,color:this.ma[a].color,y:this.ma[a].items[t]});return e}},{key:"draw",value:function(t,e,a,r){for(var o=this.data.config.height/a,i=0;i<this.ma.length;++i)this.ma[i].renderItems=[];for(var s=e.from;s<e.to;++s)for(var n=s-e.from,l=parseInt((.5+n)*r),h=0;h<this.ma.length;++h){var u=this.ma[h].items[s],u=parseInt(this.height-u*o);this.ma[h].renderItems.push({x:l,y:u})}for(var f=0;f<this.ma.length;++f)this.drawBezier(t,this.ma[f])}},{key:"calculateMA",value:function(t,e){for(var a=[],r=0,o=e.length;r<o;r++)if(r<t)a.push("-");else{for(var i=0,s=0;s<t;s++)i=parseFloat(i)+parseFloat(e[r-s].volume);a.push(parseFloat(parseFloat(i)/parseFloat(t)).toFixed(this.fixed))}return a}}]),r}();
"use strict";var _createClass=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),_get=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);return void 0!==o?"value"in o?o.value:void 0!==(o=o.get)?o.call(n):void 0:null!==(o=Object.getPrototypeOf(e))?t(o,i,n):void 0};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var RenderLast=function(){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.rect=null,t.point=null,t}return _inherits(e,Render),_createClass(e,[{key:"setData",value:function(t){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.height=this.data.config.top+this.data.config.height,this.fixed=t.fixed||8}},{key:"getRect",value:function(){return this.rect}},{key:"draw",value:function(t,e,i,n,o,a){this.point=null,this.stop();var r,i=parseInt((i+.5)*o),o=n.max-n.min,o=this.data.config.height/o,n=this.height-(e.close-n.min)*o,o=(n=(n=n<this.data.config.top?this.data.config.top:n)>this.height?this.height:n,n=parseInt(n),20),l=this.formateValue(e.close+"",this.fixed),s=t.measureText(l).width+10;t.setLineDash([8,8]),t.lineWidth=1,t.fillStyle="#fff",t.strokeStyle="#fff",i>this.data.width-100?(s+=10,this.drawLine(t,0,this.data.width,n,n),t.setLineDash([]),t.lineWidth=2,t.fillStyle="#0d1a27",t.strokeStyle="#4c5d75",r=parseInt(this.data.width-240),this.rect={x0:r-o,y0:n-o,x1:r+s+o,y1:n+o},t.beginPath(),t.moveTo(r,n+o),t.arc(r,n,o,.5*Math.PI,.5*-Math.PI),t.lineTo(r+s,n-o),t.arc(r+s,n,o,.5*-Math.PI,.5*Math.PI),t.lineTo(r,n+o),t.stroke(),t.fill(),t.closePath(),t.fillStyle="#666e92",t.font="18px font_family",t.textAlign="center",t.fillText(l,parseInt(r+.5*s-10),parseInt(n+6),parseInt(s+40)),t.fillStyle="#666e92",t.beginPath(),t.moveTo(parseInt(r+s),n),t.lineTo(parseInt(r+s-10),n+5),t.lineTo(parseInt(r+s-10),n-5),t.lineTo(parseInt(r+s),n),t.stroke(),t.fill(),t.closePath()):(this.rect=null,o=this.formateValue(e.close,this.fixed),this.drawDash(t,i,n,o),a&&(this.point={x:i,y:n,text:o,twin:!0},this.drawDot(t,i,n,25),this.play(t)))}},{key:"drawDash",value:function(t,e,i,n){t.setLineDash([8,8]),t.lineWidth=1,t.fillStyle="#fff",t.strokeStyle="#fff",this.drawLine(t,e,this.data.width-80,i,i),t.setLineDash([]),t.font="18px Arial",t.textAlign="left",t.fillStyle="#0c82df",t.fillText(n,this.data.width-80,i+6,80)}},{key:"drawDot",value:function(t,e,i,n){var o=t.createRadialGradient(e,i,2,e,i,n);o.addColorStop(0,"white"),o.addColorStop(1,"transparent"),t.fillStyle=o,t.fillRect(e-n,i-n,2*n,2*n)}},{key:"play",value:function(t){var e=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:25;this.timer=window.requestAnimationFrame(function(){e.timer=null,t.clearRect(0,0,e.data.width,e.data.height),e.point.twin?(i-=.5)<15&&(e.point.twin=!1):25<(i+=.5)&&(e.point.twin=!0),e.drawDash(t,e.point.x,e.point.y,e.point.text),e.drawDot(t,e.point.x,e.point.y,i),e.play(t,i)})}},{key:"stop",value:function(){this.timer&&(window.cancelAnimationFrame(this.timer),this.timer=null)}}]),e}();
"use strict";var _createClass=function(){function o(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t}}(),_get=function t(e,r,o){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(o):void 0:null!==(n=Object.getPrototypeOf(e))?t(n,r,o):void 0};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var RenderTime=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return _inherits(e,RenderLine),_createClass(e,[{key:"setData",value:function(t){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.height=this.data.config.top+this.data.config.height}},{key:"draw",value:function(t,e,r,o,n){for(var i=o.max-o.min,a=this.data.config.height/i,l=[],s=r.from;s<r.to;++s){var c=s-r.from,h=e[s],h=this.height-(h.low-o.min)*a;l.push({x:c*n,y:h})}t.lineWidth=2,t.strokeStyle="#393bff",this.drawBezier(t,{renderItems:l}),t.lineWidth=2,t.strokeStyle="transparent",t.beginPath(),t.moveTo(0,this.height);for(var u,f=0;f<l.length;f++)0===f?t.lineTo(l[f].x,l[f].y):(u=this.getCtrlPoint(l,f-1),t.bezierCurveTo(u.pA.x,u.pA.y,u.pB.x,u.pB.y,l[f].x,l[f].y)),f===l.length-1&&t.lineTo(l[f].x,this.height);t.stroke();i=t.createLinearGradient(0,0,0,this.height);i.addColorStop(0,"rgba(0,0,255,0.3)"),i.addColorStop(.4,"rgba(0,0,255,0.01)"),t.fillStyle=i,t.fill(),t.closePath()}}]),e}();
"use strict";var _createClass=function(){function o(t,i){for(var e=0;e<i.length;e++){var o=i[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,i,e){return i&&o(t.prototype,i),e&&o(t,e),t}}();function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,i){if(t)return!i||"object"!=typeof i&&"function"!=typeof i?t:i;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}var depth_theme_white={backgroundColor:"white",buy:{lineColor:"#5baa7f",fillColor:"rgba(91,170,120,0.2)",lineWidth:4,mark:{circleColor:"#5baa7f",circleStrokeColor:"rgba(91,170,127,0.3)",lineColor:"#2fdb98",tipsBackgroundColor:"rgba(0,0,0,0.5)",textColor:"#fff",fontSize:"24px",poleColor:"#5baa7f"}},sell:{lineColor:"#d74e5a",fillColor:"rgba(215,78,90,0.2)",lineWidth:4,mark:{circleColor:"#d74e5a",circleStrokeColor:"rgba(215,78,90,0.3)",lineColor:"#b71e29",tipsBackgroundColor:"rgba(0,0,0,0.5)",textColor:"#fff",fontSize:"24px",poleColor:"#d74e5a"}}},depth_theme_blue023={backgroundColor:"#181729",buy:{lineColor:"#5baa7f",fillColor:"#223740",lineWidth:8,mark:{circleColor:"#5baa7f",circleStrokeColor:"rgba(47,219,152,0.5)",lineColor:"#2fdb98",tipsBackgroundColor:"rgba(0,0,0,0.5)",textColor:"#fff",fontSize:"24px",poleColor:"#5baa7f"}},sell:{lineColor:"#d74e5a",fillColor:"#442738",lineWidth:8,mark:{circleColor:"#d74e5a",circleStrokeColor:"rgba(255, 0, 0, 0.2)",lineColor:"#b71e29",tipsBackgroundColor:"rgba(0,0,0,0.5)",textColor:"#fff",fontSize:"24px",poleColor:"#d74e5a"}}},DepthChart=function(){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.options=Object.assign({url:"",request:{channel:"",limit:60},el:"",backgroundColor:"#181729",updateInterval:3e4,xAxis:{width:1,color:"#484e67",offset:30,position:"bottom",mark:{textColor:"#666e92",fontSize:"24px",lineColor:"#4e5570",lineHeight:10,lineWidth:1,fixed:4}},yAxis:{width:1,color:"#666e92",top:20,position:"right",mark:{textColor:"#666e92",fontSize:"22px",lineColor:"#4e5570",lineHeight:10,lineWidth:1,fixed:4}},buy:{lineColor:"#5baa7f",fillColor:"#223740",lineWidth:2,mark:{circleColor:"#5baa7f",circleStrokeColor:"rgba(47,219,152,0.5)",lineColor:"#2fdb98",tipsBackgroundColor:"rgba(0,0,0,0.5)",textColor:"#fff",fontSize:"24px",poleColor:"#5baa7f"}},sell:{lineColor:"#d74e5a",fillColor:"#442738",lineWidth:2,mark:{circleColor:"#d74e5a",circleStrokeColor:"rgba(255, 0, 0, 0.2)",lineColor:"#b71e29",tipsBackgroundColor:"rgba(0,0,0,0.5)",textColor:"#fff",fontSize:"24px",poleColor:"#d74e5a"}}},t),i.request=i.options.request,"white"===t.theme&&(i.options=Object.assign(i.options,depth_theme_white)),i.el=i.options.el,i.url=t.url,i.el.style.position="relative",i.width=i.el.style.width||i.el.clientWidth,i.height=i.el.style.height?i.el.style.width:i.el.clientHeight,i.width*=2,i.height*=2,i.chartHeight=i.height-2*i.options.xAxis.offset-2*i.options.yAxis.top,i.canvas=i.createDom(),i.ctx=i.canvas.getContext("2d"),i.ctx.translate(.5,.5),i.el.appendChild(i.canvas),i.drawBackground(),i.loading(),i.topCanvas=i.createDom(),i.topCtx=i.topCanvas.getContext("2d"),i.topCtx.translate(.5,.5),i.el.appendChild(i.topCanvas),i.fetchData(),i.initEvent(),i}return _inherits(e,RenderLine),_createClass(e,[{key:"initEvent",value:function(){var o=this,e=!(this.curIdx=-1),s=!1,a=null,l=null;this.topCanvas.addEventListener("touchstart",function(t){e=s=!1;var i=t.touches[0].pageX;a=i,l=t.touches[0].pageY,o.longTimerHandler&&(clearTimeout(o.longTimerHandler),o.longTimerHandler=null),o.longTimerHandler=setTimeout(function(){o.longTimerHandler=null,o.onTouch(i),e=!0},300)}),this.topCanvas.addEventListener("touchmove",function(t){var i=t.touches[0],e=Math.abs(l-i.pageY);Math.abs(a-i.pageX)<e?(o.longTimerHandler&&(clearTimeout(o.longTimerHandler),o.longTimerHandler=null),t.stopPropagation()):(t.preventDefault(),o.longTimerHandler&&(clearTimeout(o.longTimerHandler),o.longTimerHandler=null),o.data&&(s=!0,i=t.touches[0].pageX,o.onTouch(i)))}),this.topCanvas.addEventListener("touchend",function(t){o.longTimerHandler&&(clearTimeout(o.longTimerHandler),o.longTimerHandler=null),s||e||o.topCtx.clearRect(0,0,o.width,o.width),e=s=!1})}},{key:"onTouch",value:function(i){var t;(i*=2)<=this.data.asks[0].x?-1!==(t=this.data.bids.findIndex(function(t){return t.x>=i}))?(0<t&&(t=i-this.data.bids[t-1].x>this.data.bids[t].x-i?t:t-1),this.curIdx!==t&&(this.curIdx=t,t=this.data.bids[t],this.drawPoint(t,this.options.buy))):(this.curIdx=-1,this.topCtx.clearRect(0,0,this.width,this.height)):i>=this.data.asks[0].x&&(-1!==(t=this.data.asks.findIndex(function(t){return t.x>=i}))?(0<t&&(t=i-this.data.asks[t-1].x>this.data.asks[t].x-i?t:t-1),this.curIdx!==t&&(this.curIdx=t,t=this.data.asks[t],this.drawPoint(t,this.options.sell))):(this.curIdx=-1,this.topCtx.clearRect(0,0,this.width,this.width)))}},{key:"drawPoint",value:function(t,i){this.topCtx.clearRect(0,0,this.width,this.width),this.topCtx.lineWidth=2,this.topCtx.strokeStyle=i.mark.lineColor,this.topCtx.beginPath(),this.topCtx.setLineDash([10]),this.topCtx.moveTo(t.x,this.height-2*this.options.xAxis.offset),this.topCtx.lineTo(t.x,t.y),this.topCtx.stroke(),this.topCtx.closePath(),this.topCtx.save(),this.topCtx.setLineDash([]),this.topCtx.lineWidth=16,this.topCtx.beginPath(),this.topCtx.arc(t.x,t.y,10,2*Math.PI,0,!1),this.topCtx.fillStyle=i.mark.circleColor,this.topCtx.strokeStyle=i.mark.circleStrokeColor,this.topCtx.fill(),this.topCtx.stroke(),this.topCtx.closePath(),this.topCtx.save(),this.topCtx.textAlign="center",this.topCtx.font="24px Arial";var e=this.topCtx.measureText(t.price).width+20,o=(this.topCtx.setLineDash([]),this.topCtx.strokeStyle=i.mark.lineColor,this.topCtx.fillStyle="#181728",this.topCtx.lineWidth=4,this.topCtx.beginPath(),this.topCtx.moveTo(t.x-.5*e,this.height-2*this.options.xAxis.offset),this.topCtx.lineTo(t.x+.5*e,this.height-2*this.options.xAxis.offset),this.topCtx.lineTo(t.x+.5*e,this.height-2*this.options.xAxis.offset+32),this.topCtx.lineTo(t.x-.5*e,this.height-2*this.options.xAxis.offset+32),this.topCtx.lineTo(t.x-.5*e,this.height-2*this.options.xAxis.offset),this.topCtx.stroke(),this.topCtx.fill(),this.topCtx.closePath(),this.topCtx.fillStyle=i.mark.lineColor,this.topCtx.fillText(t.price,t.x,this.height-2*this.options.xAxis.offset+24,e),this.formateValue(t.total,this.options.yAxis.mark.fixed)),e=this.topCtx.measureText(o).width+20;this.topCtx.strokeStyle=i.mark.lineColor,this.topCtx.fillStyle="#181728",this.topCtx.lineWidth=4,this.topCtx.beginPath(),this.topCtx.moveTo(this.width-e,t.y+16),this.topCtx.lineTo(this.width-4,t.y+16),this.topCtx.lineTo(this.width-4,t.y-16),this.topCtx.lineTo(this.width-e,t.y-16),this.topCtx.lineTo(this.width-e,t.y+16),this.topCtx.stroke(),this.topCtx.fill(),this.topCtx.closePath(),this.topCtx.fillStyle=i.mark.lineColor,this.topCtx.fillText(o,this.width-.5*e,t.y+8,e)}},{key:"changeTheme",value:function(t){this.options.theme=t,this.options="white"===t?Object.assign(this.options,depth_theme_white):Object.assign(this.options,depth_theme_blue023),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBackground(),this.initChart()}},{key:"update",value:function(t){this.request.channel!==t&&(this.stopUpdate(),this.request.channel=t,this.loading(),this.fetchData())}},{key:"startUpdate",value:function(){var t=this;this.stopUpdate(),this.options.updateInterval&&(this.updateTimerHandler=setTimeout(function(){t.updateTimerHandler=null,t.fetchData()},this.options.updateInterval))}},{key:"stopUpdate",value:function(){this.updateTimerHandler&&(clearTimeout(this.updateTimerHandler),this.updateTimerHandler=null)}},{key:"destroy",value:function(){this.stopUpdate(),this.longTimerHandler&&(clearTimeout(this.longTimerHandler),this.longTimerHandler=null)}},{key:"initChart",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBackground(),this.draw()}},{key:"drawBuyMain",value:function(){for(var t=this.data.bids,i=this.height-2*this.options.xAxis.offset,e=(i-2*this.options.yAxis.top)/this.data.yRange.max,o=this.width/(this.data.xRange.max-this.data.xRange.min),s=(this.ctx.strokeStyle=this.options.buy.lineColor,this.ctx.lineWidth=2*this.options.buy.lineWidth,this.ctx.beginPath(),this.ctx.moveTo(0,i),0);s<t.length;++s){var a=t[s];t[s].x=parseInt((a.price-this.data.xRange.min)*o),t[s].y=parseInt(i-a.total*e),this.ctx.lineTo(t[s].x,t[s].y)}this.ctx.lineTo(t[s-1].x,i),this.ctx.stroke(),this.ctx.fillStyle=this.options.buy.fillColor,this.ctx.fill(),this.ctx.closePath()}},{key:"drawSellMain",value:function(){var t=this.data.asks,i=this.height-2*this.options.xAxis.offset,e=(i-2*this.options.yAxis.top)/this.data.yRange.max,o=this.width/(this.data.xRange.max-this.data.xRange.min);this.ctx.strokeStyle=this.options.sell.lineColor,this.ctx.lineWidth=2*this.options.sell.lineWidth,this.ctx.beginPath(),t[0].x=(t[0].price-this.data.xRange.min)*o,t[0].y=i-t[0].total*e,this.ctx.moveTo(t[0].x,i);for(var s=0;s<t.length;++s){var a=t[s];t[s].x=parseInt((a.price-this.data.xRange.min)*o),t[s].y=parseInt(i-a.total*e),this.ctx.lineTo(t[s].x,t[s].y)}this.ctx.lineTo(this.width,i),this.ctx.stroke(),this.ctx.fillStyle=this.options.sell.fillColor,this.ctx.fill(),this.ctx.closePath()}},{key:"draw",value:function(){this.data&&(this.drawBuyMain(),this.drawSellMain(),this.drawAxis()),this.drawMark()}},{key:"drawMark",value:function(){this.ctx.fillStyle=this.options.buy.lineColor,this.ctx.fillRect(.5*this.width-50,40,16,16),this.ctx.fillStyle="#6d6282",this.ctx.textAlign="left",this.ctx.fillText("买盘",.5*this.width-26,56,100),this.ctx.fillStyle=this.options.sell.lineColor,this.ctx.fillRect(.5*this.width+50,40,16,16),this.ctx.fillStyle="#6d6282",this.ctx.textAlign="left",this.ctx.fillText("卖盘",.5*this.width+76,56,100)}},{key:"drawAxis",value:function(){var t=this.options.yAxis;this.ctx.lineWidth=2*t.width,this.ctx.strokeStyle=t.color,this.drawYLabel(),this.drawXLabel()}},{key:"drawXLabel",value:function(){var t=this.options.xAxis.mark,i=this.data.xRange.max-this.data.xRange.min,i=this.width/i,i=parseInt((this.data.xRange.mid-this.data.xRange.min)*i),e=parseInt(this.height-2*this.options.xAxis.offset+30);this.ctx.fillStyle=t.textColor,this.ctx.font=t.fontSize+" Arial",this.ctx.textAlign="center",this.ctx.fillText(this.formateValue(this.data.xRange.mid,t.fixed),i,e,120),this.ctx.textAlign="left",this.ctx.fillText(this.formateValue(this.data.xRange.min,t.fixed),15,e,120),this.ctx.textAlign="right",this.ctx.fillText(this.formateValue(this.data.xRange.max,t.fixed),this.width-15,e,120)}},{key:"drawYLabel",value:function(){var t=this.options.yAxis.mark,i=this.height-2*this.options.xAxis.offset,e=(i-2*this.options.yAxis.top)/5;this.ctx.lineWidth=2*t.lineWidth,this.ctx.strokeStyle=t.lineColor,this.ctx.fillStyle=t.textColor,this.ctx.font=t.fontSize+" Arial",this.ctx.textAlign="right";for(var o=0;o<5;++o){var s=this.data.yRange.max*(o+1)/5;this.ctx.fillText(this.formateValue(s,t.fixed),this.width-15,parseInt(i-e*(o+1)),100)}}},{key:"drawBackground",value:function(){this.options.backgroundColor&&(this.ctx.fillStyle=this.options.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save())}},{key:"loading",value:function(){this.loadingCanvas||(this.loadingCanvas=new Sonic({width:.5*this.width,height:.5*this.height,stepsPerFrame:3,trailLength:1,pointDistance:.01,fps:30,step:"fader",style:{position:"absolute",left:0,top:0},strokeColor:"#456995",setup:function(){this._.lineWidth=5},path:[["arc",.25*this.width+20,.25*this.height,30,360,0]]}),this.loadingCanvas.play(),this.el.appendChild(this.loadingCanvas.canvas))}},{key:"fetchData",value:function(){var r=this;this.fetch(this.url+this.query(this.request),function(t){if(r.removeLoading(),t){var i=t.bids,e=t.asks;if(i.length<5||i.length<5)r.data=null,r.initChart();else{i.sort(function(t,i){return parseFloat(t.price)>parseFloat(i.price)?1:-1}),e.sort(function(t,i){return parseFloat(t.price)>parseFloat(i.price)?1:-1});for(var o=parseFloat(i[0].total),s=parseFloat(i[0].total),a=0;a<i.length;++a){var l=parseFloat(i[a].total);s<l?s=l:l<o&&(o=l)}for(var h=0;h<e.length;++h){var n=parseFloat(e[h].total);s<n?s=n:n<o&&(o=n)}r.data={bids:i,asks:e,xRange:{min:parseFloat(i[0].price),max:parseFloat(e[e.length-1].price),mid:.5*(parseFloat(i[i.length-1].price)+parseFloat(e[0].price))},yRange:{min:parseFloat(o),max:parseFloat(s).toFixed(8)}},r.initChart(),r.startUpdate()}}})}},{key:"removeLoading",value:function(){this.loadingCanvas&&(this.el.removeChild(this.loadingCanvas.canvas),delete this.loadingCanvas,this.loadingCanvas=null)}}]),e}();
"use strict";var _createClass=function(){function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var PieChart=function(){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.options=t,e.el=e.options.el,e.el.style.position="relative",e.width=e.el.style.width||e.el.clientWidth,e.height=e.el.style.height?e.el.style.width:e.el.clientHeight,e.width*=2,e.height*=2,e.canvas=e.createDom(),e.ctx=e.canvas.getContext("2d"),e.ctx.translate(.5,.5),e.el.appendChild(e.canvas),e.x0=e.width/2,e.y0=e.height/2,e.radius=e.x0>e.y0?.5*e.y0:.5*e.x0,e.inr=.6*e.radius,e.outLine=20,e.font=24,e.pieData=t.pieData||[],e.loopId=null,e.speed=.1,e.rate=100,e.circle=4,e.ratio=1.4,e}return _inherits(i,Render),_createClass(i,[{key:"loopAni",value:function(){var e=this;this.loopId=requestAnimationFrame(function(){var t,s;1<e.speed||(t=JSON.parse(JSON.stringify(e.angleList)).map(function(t){return t.angle=t.angle*e.speed,t}),s=0,e.ctx.beginPath(),e.ctx.moveTo(e.x0,e.y0),e.ctx.fillStyle="#333",e.ctx.arc(e.x0,e.y0,e.radius*e.ratio,0,2*Math.PI),e.ctx.fill(),t.forEach(function(t,e){var i=t.angle+s;this.ctx.beginPath(),this.ctx.moveTo(this.x0,this.y0),this.ctx.fillStyle=t.color,this.ctx.arc(this.x0,this.y0,this.radius*this.ratio,s+.02,i-.02),this.ctx.fill(),.98<this.speed&&this.drawTitle(s,t,this.ctx.fillStyle),s=i}.bind(e)),e.speed+=.02,e.ctx.beginPath(),e.ctx.moveTo(e.x0,e.y0),e.ctx.fillStyle="#13161e",e.ctx.arc(e.x0,e.y0,e.inr*e.ratio,0,2*Math.PI),e.ctx.fill(),e.speed=Number(e.speed.toFixed(2)),e.loopAni())})}},{key:"drawPie",value:function(){this.angleList=this.drawAngle(),this.loopAni()}},{key:"drawAngle",value:function(){var s=0;return this.pieData.forEach(function(t,e){s+=t.num}),this.pieData.forEach(function(t,e){var i=t.num/s*Math.PI*2;t.angle=i}),this.pieData}},{key:"drawTitle",value:function(t,e,i){this.ctx.beginPath();var s=this.radius+this.outLine,n=this.radius*Math.cos(t+e.angle/2)*this.ratio,o=this.radius*Math.sin(t+e.angle/2)*this.ratio,a=s*Math.cos(t+e.angle/2)*this.ratio,s=s*Math.sin(t+e.angle/2)*this.ratio,t=this.x0+a,a=this.y0+s,s=(this.ctx.beginPath(),this.ctx.moveTo(this.x0+n,this.y0+o),this.ctx.lineTo(t,a),this.ctx.strokeStyle=i,this.ctx.stroke(),t>this.x0?"left":"right"),n=(this.ctx.font=this.font+"px 微软雅黑",this.ctx.textAlign=s,this.ctx.textBaseline="bottom",this.ctx.fillStyle=i,t>this.x0?t+1.5*this.font:t-1.5*this.font),o=(this.ctx.fillText(e.title,n,a-5),this.ctx.fillText("30%",n,a+this.font),this.ctx.beginPath(),this.ctx.measureText(e.title).width),s=t>this.x0?t+1.5*this.font-(this.font/2).toFixed(1):t-1.5*this.font-(this.font/2).toFixed(1)-o,n=(this.ctx.arc(s,a-this.font/2-this.circle/4,this.circle,0,2*Math.PI),this.ctx.fillStyle=i,this.ctx.fill(),this.ctx.measureText(e.title).width+2*this.font);this.ctx.moveTo(t,a),t=t>this.x0?t+n:t-n,this.ctx.lineTo(t,a),this.ctx.stroke()}},{key:"destroy",value:function(){this.canvas.remove()}}]),i}();