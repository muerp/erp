"use strict";var _createClass=function(){function n(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,a,t){return a&&n(e.prototype,a),t&&n(e,t),e}}();function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var MainModalView=function(){function a(e){_classCallCheck(this,a),this.app=e.app,this.key=e.key,this.options=e,this.type=e.type}return _createClass(a,null,[{key:"create",value:function(e){if(e.app&&e.app.topView){var a=e.app.topView.key;if(e.app.closeDialog(),a===e.key)return!1}return!0}}]),_createClass(a,[{key:"close",value:function(){this.app&&this.app.clearDialog()}}]),a}();
"use strict";var _createClass=function(){function n(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,i,e){return i&&n(t.prototype,i),e&&n(t,e),t}}();function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var DragView=function(){function f(t){var i=this,e=t.container,n=t.onDragEnd,o=t.onDragStart,r=t.onDragMove,s=t.forbiddenVer,h=t.onlyFitScale,a=t.minWidth,a=void 0===a?50:a,d=t.autoHeight,g=t.dragType,g=void 0===g?100:g,l=t.forbiddenScale,t=t.noCheckEdge,t=void 0===t||t,o=(_classCallCheck(this,f),this.onDragStart=o,this.onDragMove=r,this.onDragEnd=n,this.enabled=!0,this.container=e,this.forbiddenVer=s,this.onlyFitScale=h,this.dragType="",this.dragBarWidth=7,this.isMove=!1,this.pre={},this.minWidth=a,this.autoHeight=d,this.dragType=g,this.forbiddenScale=l,this.noCheckEdge=t,this.dragBox={},this._onBoxPointerDown=this.onBoxPointerDown.bind(this),this._onDragBox=this.onDragBox.bind(this),this._onEndDragBox=this.onEndDragBox.bind(this),e.getElementsByClassName("drag-header"));if(0===o.length)e.addEventListener("pointerdown",this._onBoxPointerDown);else{var c=!0,r=!1,n=void 0;try{for(var p,v=o[Symbol.iterator]();!(c=(p=v.next()).done);c=!0)p.value.addEventListener("pointerdown",this._onBoxPointerDown)}catch(t){r=!0,n=t}finally{try{!c&&v.return&&v.return()}finally{if(r)throw n}}}if(!l){var u=document.createElement("div");for(u.innerHTML='<div class="drag-line-left"></div><div class="drag-line-right"></div>'+(s?"":'<div class="drag-line-top"></div><div class="drag-line-bottom"></div><div class="drag-angle-lt"></div><div class="drag-angle-lb"></div><div class="drag-angle-rt"></div><div class="drag-angle-rb"></div>'),s?e.classList.add("scale-hor"):h&&e.classList.add("scale-fit"),this._onDragMouseMove=this.onDragMouseMove.bind(this),this._onDragMouseUp=this.onDragMouseUp.bind(this),this._onPointerdown=this.onPointerdown.bind(this),u.querySelectorAll("div").forEach(function(t){t.addEventListener("pointerdown",i._onPointerdown)});u.firstChild;)e.append(u.firstChild)}}return _createClass(f,[{key:"changeOptions",value:function(t){t.minWidth&&(this.minWidth=t.minWidth),!0===t.noCheckEdge?this.noCheckEdge=!0:!1===t.noCheckEdge&&(this.noCheckEdge=!1)}},{key:"onPointerdown",value:function(t){var i,e;this.enabled&&(this.onDragStart&&this.onDragStart(),t.stopPropagation(),this.isMove=!1,this.dragType=t.target.className,i=this.container.getBoundingClientRect(),this.ratio||(this.ratio=i.width/i.height),e=this.container.parentNode.getBoundingClientRect(),this.pre.left=i.left-e.left,this.pre.top=i.top-e.top,this.pre.width=i.width,this.pre.height=i.height,this.pre.clientX=t.clientX,this.pre.clientY=t.clientY,window.addEventListener("pointermove",this._onDragMouseMove),window.addEventListener("pointerup",this._onDragMouseUp),"drag-angle-rt"===this.dragType||"drag-angle-lb"===this.dragType?(this.container.parentNode.style.cursor="nesw-resize",this.container.parentNode.style.pointerEvents="auto"):"drag-angle-lt"!==this.dragType&&"drag-angle-rb"!==this.dragType||(this.container.parentNode.style.cursor="nwse-resize",this.container.parentNode.style.pointerEvents="auto"))}},{key:"onDragMouseMove",value:function(t){this.isMove=!0;var i=void 0,e=void 0,n=void 0,o=void 0,r=this.container.parentNode.getBoundingClientRect();"drag-line-right"!==this.dragType&&"drag-angle-rt"!==this.dragType&&"drag-angle-rb"!==this.dragType||(s=t.clientX-r.left-this.dragBarWidth,this.noCheckEdge||(s>r.width?s=r.width:s<this.pre.left+this.minWidth&&(s=this.pre.left+this.minWidth)),n=s-this.pre.left),"drag-line-left"!==this.dragType&&"drag-angle-lt"!==this.dragType&&"drag-angle-lb"!==this.dragType||(i=t.clientX-r.left+this.dragBarWidth,this.noCheckEdge||(i<0?i=0:i>this.pre.left+this.pre.width-this.minWidth&&(i=this.pre.left+this.pre.width-this.minWidth)),n=this.pre.left+this.pre.width-i),this.forbiddenVer||("drag-line-top"!==this.dragType&&"drag-angle-rt"!==this.dragType&&"drag-angle-lt"!==this.dragType||(e=t.clientY-r.top,this.noCheckEdge||(e<0?e=0:e>this.pre.top+this.pre.height-this.minWidth&&(e=this.pre.top+this.pre.height-this.minWidth)),o=this.pre.top+this.pre.height-e),"drag-line-bottom"!==this.dragType&&"drag-angle-lb"!==this.dragType&&"drag-angle-rb"!==this.dragType)||(s=t.clientY-r.top,this.noCheckEdge||(s>r.height?s=r.height:s<this.pre.top+this.minWidth&&(s=this.pre.top+this.minWidth)),o=s-this.pre.top),this.onlyFitScale&&!this.autoHeight&&(this.ratio>n/o?this.autoHeight||(t=n/this.ratio,void 0!==e&&(e+=o-t),o=t):(s=o*this.ratio,void 0!==i&&(i+=n-s),n=s)),void 0!==i&&(this.container.style.left=(i/r.width*100).toFixed(2)+"%");var t=this.container.getBoundingClientRect().top,s=this.container.getBoundingClientRect().height;void 0!==n&&(this.container.style.width=n+"px"),void 0!==e&&(this.container.style.top=e+"px"),void 0===o||this.autoHeight||(this.container.style.height=o+"px"),this.onDragMove&&this.onDragMove(),!this.autoHeight||"drag-angle-rt"!==this.dragType&&"drag-angle-lt"!==this.dragType||(e=t-this.container.getBoundingClientRect().height+s,this.container.style.top=e+"px")}},{key:"onDragMouseUp",value:function(){this.onDragEnd&&this.onDragEnd(this.isMove),this.isMove=!1,window.removeEventListener("pointermove",this._onDragMouseMove),window.removeEventListener("pointerup",this._onDragMouseUp),this.container.parentNode.style.cursor="auto",this.container.parentNode.style.pointerEvents="auto"}},{key:"onBoxPointerDown",value:function(t){var i;t.stopPropagation(),this.enabled&&(this.onDragStart&&this.onDragStart(),this.isMove=!1,i=this.container.getBoundingClientRect(),this.dragBox.left=t.clientX-i.left,this.dragBox.top=t.clientY-i.top,window.addEventListener("pointermove",this._onDragBox),window.addEventListener("pointerup",this._onEndDragBox))}},{key:"onEndDragBox",value:function(){var t=this;this.onDragEnd&&this.onDragEnd(this.isMove),setTimeout(function(){t.isMove=!1},50),window.removeEventListener("pointermove",this._onDragBox),window.removeEventListener("pointerup",this._onEndDragBox)}},{key:"onDragBox",value:function(t){this.isMove=!0;var i=this.container.getBoundingClientRect(),e=this.container.parentNode.getBoundingClientRect(),n=t.clientX-this.dragBox.left-e.left,o=(n<0&&!this.noCheckEdge&&(n=0,t.clientX>e.left)&&(this.dragBox.left=t.clientX-i.left),e.width-i.width),o=(o<n&&!this.noCheckEdge&&(n=o,t.clientX<e.left+e.width)&&(this.dragBox.left=t.clientX-i.left),t.clientY-this.dragBox.top-e.top),r=(o<0&&!this.noCheckEdge&&(o=0,t.clientY>e.top)&&(this.dragBox.top=t.clientY-i.top),e.height-i.height);r<o&&!this.noCheckEdge&&(o=r,t.clientY<e.top+e.height)&&(this.dragBox.top=t.clientY-i.top),this.container.style.left=(n/e.width*100).toFixed(2)+"%",this.container.style.top=(o/e.height*100).toFixed(2)+"%"}},{key:"setDisabled",value:function(t){this.enabled=!t}}]),f}();
"use strict";var _get=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);return void 0!==o?"value"in o?o.value:void 0!==(o=o.get)?o.call(n):void 0:null!==(o=Object.getPrototypeOf(t))?e(o,i,n):void 0},_createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var DialogView=function(){function o(e){_classCallCheck(this,o);var t,i,n=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return n.div=$('<div class="main-dialog"><div class="dialog-pointer"></div></div>'),n.inner=$('<div class="dialog-inner">\n                            <div class="dialog-header drag-header d-between">\n                            <div class="d-flex">\n                                '+e.icon+"\n                                <span class=dialog-title>"+e.title+'</span>\n                            </div>\n                            <div class="dialog-close"><i class="icon-close"></i></div>\n                            </div>\n                        </div>'),e.width&&n.inner.css({width:e.width+"px"}),e.height&&n.inner.css({height:e.height+"px"}),e.className&&n.div.addClass(e.className),n.div.append(n.inner),n.app.div.append(n.div),e.el&&n.inner.append(e.el),e.offset?n.inner.css({left:e.offset.left+"px",top:e.offset.top+"px"}):(t=n.inner.width(),i=n.inner.height(),n.inner.css({left:"calc(50% - "+.5*t+"px)",top:"calc(50% - "+.5*i+"px)"})),e.clickClose&&(n._close=n.close.bind(n),setTimeout(function(){n.timer=window.addEventListener("click",n._close)},200)),n.inner.find(".dialog-close").click(function(){e.clickAudio&&e.clickAudio(),n.close()}),n.dragView=new DragView({container:n.inner[0],forbiddenScale:!e.allScale,onlyFitScale:!1,minWidth:e.minWidth}),n}return _inherits(o,MainModalView),_createClass(o,null,[{key:"create",value:function(e){MainModalView.create(e)&&(e.app.topView=new o(e))}}]),_createClass(o,[{key:"close",value:function(){_get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"close",this).call(this),this.options.clickClose&&window.removeEventListener("click",this._close),clearTimeout(this.timer),this.div.remove()}}]),o}();
"use strict";var _get=function e(t,i,o){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);return void 0!==s?"value"in s?s.value:void 0!==(s=s.get)?s.call(o):void 0:null!==(s=Object.getPrototypeOf(t))?e(s,i,o):void 0},_createClass=function(){function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var DropView=function(){function i(o){_classCallCheck(this,i);var s=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,o));return s.level=o.level||0,s.curItem=0<=o.defaultIndex?o.menus[o.defaultIndex]:void 0,s.div=$('<div class="mini-drop'+(o.direction?" dir-"+o.direction:"")+'"></div>'),o.className&&s.div.addClass(o.className),o.el.append(s.div),o.menus.forEach(function(t,e){var i=$('<div class="drop-item'+(t.line?" drop-line":"")+'">\n                                <div class="drop-item-inner'+(t.active?" active":"")+'" short-key="'+t.shortcutKey+'">\n                                    <div class="drop-label">\n                                        '+t.text+"\n                                    </div>\n                                    "+(t.shortcutKey2?"<span>"+t.shortcutKey2+"</span>":t.children?'<i class="icon-arrow-left"></i>':"")+"\n                                </div>\n                          </div>");t.index=e,t.el=i.find(".drop-item-inner"),t.el.click(function(e){e.stopPropagation(),t.children?s.openChildren(t):(s.close(),o.onClick&&o.onClick(t))}),t.el.on("pointerenter",function(e){s.pointerEnter(t)}),s.div.append(i)}),s.curItem&&s.curItem.el.addClass("hovered"),s._close=s.close.bind(s),setTimeout(function(){s.timer=window.addEventListener("click",s._close)},200),s}return _inherits(i,MainModalView),_createClass(i,null,[{key:"create",value:function(e){MainModalView.create(e)&&e.app&&(e.app.topView=new i(e))}}]),_createClass(i,[{key:"pointerEnter",value:function(e){this.curItem&&(this.curItem.topView&&(this.curItem.topView.close(),this.curItem.topView=void 0),this.curItem.el.removeClass("hovered")),this.curItem=e,this.curItem.el.addClass("hovered"),0<this.level&&this.options.el.addClass("selected")}},{key:"openChildren",value:function(e){var t=this;this.curItem&&(this.curItem.topView&&(this.curItem.topView.close(),this.curItem.topView=void 0),this.curItem.el.removeClass("hovered")),e.topView||((this.curItem=e).el.addClass("hovered"),e.topView=new i({type:"sub-menus",direction:"right",el:e.el,level:this.level+1,key:e.shortcutKey,menus:e.children,onClick:function(e){t.options.onClick&&t.options.onClick(e),t.close()}}))}},{key:"isValidLeft",value:function(){return!!this.curItem&&!!this.curItem.topView}},{key:"isValidRight",value:function(){return console.log("---",this.level),0<this.level&&!this.curItem||this.curItem&&this.curItem.children&&(!this.curItem.topView||this.curItem.topView.isValidRight())}},{key:"select",value:function(){this.pointerEnter(this.options.menus[0<arguments.length&&void 0!==arguments[0]?arguments[0]:0])}},{key:"onEnter",value:function(){this.curItem&&(this.curItem.el.hasClass("selected")&&this.curItem.topView?this.curItem.topView.onEnter():this.curItem.el.hasClass("hovered")&&this.curItem.el.click())}},{key:"onLeft",value:function(){this.curItem&&this.curItem.topView&&(this.curItem.topView.close(),this.curItem.topView=void 0)}},{key:"onRight",value:function(){this.curItem&&(this.curItem.topView?this.curItem.topView.select():this.openChildren(this.curItem))}},{key:"onDown",value:function(){if(this.curItem){if(this.curItem.el.hasClass("selected")&&this.curItem.topView)return void this.curItem.topView.onDown();this.curItem.topView&&(this.curItem.topView.close(),this.curItem.topView=void 0),this.curItem.el.removeClass("hovered")}var e=this.curItem?this.curItem.index+1:0;e>this.options.menus.length-1&&(e=0),this.curItem=this.options.menus[e],this.curItem.el.addClass("hovered")}},{key:"onUp",value:function(){if(this.curItem){if(this.curItem.el.hasClass("selected")&&this.curItem.topView)return void this.curItem.topView.onUp();this.curItem.topView&&(this.curItem.topView.close(),this.curItem.topView=void 0),this.curItem.el.removeClass("hovered")}var e=this.curItem?this.curItem.index-1:0;e<0&&(e=this.options.menus.length-1),this.curItem=this.options.menus[e],this.curItem.el.addClass("hovered")}},{key:"close",value:function(){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"close",this).call(this),window.removeEventListener("click",this._close),clearTimeout(this.timer),this.div.remove(),0<this.level&&this.options.el.removeClass("selected"),this.curItem&&(this.curItem.topView=void 0)}}]),i}();
"use strict";var _createClass=function(){function n(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,i,t){return i&&n(e.prototype,i),t&&n(e,t),e}}();function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var MainWidget=function(){function o(t){var n=this,e=(_classCallCheck(this,o),this.options=t,this.active=!0,t.el||$('<div class="main-widget"></div>')),i=(e.css({top:t.top||"0px",left:t.left||"0px"}),t.el||window.document.body.appendChild(e[0]),this.div=e,this.createNavbar(),this.createMenu(),this.createBox(),this.options.dragConfig);i.container=e[0],this.dragView=new DragView(i),$(document).keydown(function(i){var e;"INPUT"!==$(i.target).prop("tagName")&&n.active&&(t.onKeydown&&t.onKeydown(i),"Escape"===i.key?(n.topView&&n.options.clickAudio&&n.options.clickAudio(),n.closeDialog()):"ArrowDown"===i.key?n.topView&&n.topView.onDown&&n.topView.onDown():"ArrowUp"===i.key?n.topView&&n.topView.onUp&&n.topView.onUp():"ArrowLeft"===i.key?n.topView&&"main-menus"===n.topView.type&&(n.topView.isValidLeft()?n.topView.onLeft&&n.topView.onLeft():n.curMenuItem&&(e=-1!==(e=n.options.menus.findIndex(function(e){return e.key===n.curMenuItem.key}))?--e<0?n.options.menus.length-1:e:0,n.onClickMenu(n.options.menus[e].el,n.options.menus[e],!1))):"ArrowRight"===i.key?n.topView&&"main-menus"===n.topView.type&&(n.topView.isValidRight()?n.topView.onRight&&n.topView.onRight():n.curMenuItem&&(e=-1!==(e=n.options.menus.findIndex(function(e){return e.key===n.curMenuItem.key}))?++e>n.options.menus.length-1?0:e:n.options.menus.length-1,n.onClickMenu(n.options.menus[e].el,n.options.menus[e],!1))):"Enter"===i.key?n.topView&&"main-menus"===n.topView.type&&n.topView.onEnter&&n.topView.onEnter():(e=n.options.menus.find(function(e){return e.shortcutKey.toLowerCase()===i.key}))?(e=n.menuView.find('[short-key="'+e.shortcutKey+'"]'))&&e.click():(e=n.menuView.find('[short-key="'+i.key.toUpperCase()+'"]'))&&e.click())}),$(document).keyup(function(e){"INPUT"!==$(e.target).prop("tagName")&&t.onKeyup&&t.onKeyup()})}return _createClass(o,[{key:"getOffset",value:function(e){var i=$(e).offset(),t=this.div.offset();return{top:i.top-t.top+$(e).outerHeight(),left:i.left-t.left}}},{key:"changeDragOptions",value:function(e){this.div.css({width:"auto"}),this.dragView.changeOptions(e)}},{key:"createNavbar",value:function(){this.navbar=$('<div class="main-navbar d-flex'+(this.options.isDragHeader?" drag-header":"")+'"></div>'),this.navbarLeftDiv=$('<div class="d-flex"></div>'),this.div.append(this.navbar),this.navbar.append(this.navbarLeftDiv),this.options.leftIcon&&this.navbarLeftDiv.append(this.options.leftIcon),this.options.leftText&&this.navbarLeftDiv.append('<span class="navbar-title">'+this.options.leftText+"</span>"),this.minEl=$('<div class="navbar-m minimum"></div>'),this.maxEl=$('<div class="navbar-m maximize"></div>'),this.fullEl=$('<div class="navbar-m maximize"></div>'),this.navbar.append(this.minEl),this.navbar.append(this.maxEl),this.navbar.append(this.fullEl)}},{key:"createBox",value:function(){this.view=$('<div class="main-box"></div>'),this.div.append(this.view)}},{key:"onClickMenu",value:function(i,e){var t=this;2<arguments.length&&void 0!==arguments[2]&&!arguments[2]||!this.options.clickAudio||this.options.clickAudio(),this.curMenuItem&&this.curMenuItem.el.find(".menu-click").removeClass("active"),e.el.find(".menu-click").addClass("active"),DropView.create({app:this,type:"main-menus",el:e.el,key:e.shortcutKey,menus:e.children,onClick:function(e){t.options.onMenu&&t.options.onMenu(i,e)}}),this.curMenuItem=e}},{key:"createMenu",value:function(){var t=this;this.menuView=$('<div class="game-menu'+(this.options.isDragHeader?" drag-header":"")+'"></div>'),this.options.menus.forEach(function(i){var e=$('<div class="menu-item"><div class="menu-click" short-key="'+i.shortcutKey+'">'+i.text+"("+i.shortcutKey+")</div></div>");(i.el=e).find(".menu-click").click(function(e){t.onClickMenu(e,i)}),e.find(".menu-click").on("pointerenter",function(e){t.topView&&"main-menus"===t.topView.type&&t.topView.key!==i.shortcutKey&&t.onClickMenu(e,i,!1)}),t.menuView.append(e)}),this.div.append(this.menuView)}},{key:"destroy",value:function(){this.closeDialog()}},{key:"clearDialog",value:function(){this.topView=void 0,this.curMenuItem&&(this.curMenuItem.el.find(".menu-click").removeClass("active"),this.curMenuItem=void 0)}},{key:"closeDialog",value:function(){this.topView&&(this.curMenuItem&&(this.curMenuItem.el.find(".menu-click").removeClass("active"),this.curMenuItem=void 0),this.topView.close(),this.topView=void 0)}}]),o}();